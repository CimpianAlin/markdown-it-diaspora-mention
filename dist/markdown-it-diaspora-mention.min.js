/*! markdown-it-diaspora-mention 0.1.1 https://github.com/diaspora/markdown-it-diaspora-mention @license MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.markdownitDiasporaMention=e()}}(function(){return function e(n,t,r){function o(l,u){if(!t[l]){if(!n[l]){var f="function"==typeof require&&require;if(!u&&f)return f(l,!0);if(i)return i(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[l]={exports:{}};n[l][0].call(p.exports,function(e){var t=n[l][1][e];return o(t?t:e)},p,p.exports,e,n,t,r)}return t[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,n){"use strict";function t(e,n){return'<a href="'+e[n].content+'" class="mention">'}function r(){return"</a>"}function o(e,n){return e[n].content}function i(e){return/^<a[>\s]/i.test(e)}function l(e){return/^<\/a\s*>/i.test(e)}n.exports=function(e,n){function u(e){var t;for(t=0;t<n.length;t++)if(e===n[t].diaspora_id||e===n[t].handle)return n[t];return null}function f(e){var n,t,r,o,f,s,a,d,h,y,v,m,x,g,_,w,k,q,E=e.tokens,O="@\\{([^;]+); ([^\\}]+)\\}";for(k=new RegExp(O),q=new RegExp(O,"g"),t=0,r=E.length;r>t;t++)if("inline"===E[t].type)for(s=E[t].children,a=0,n=s.length-1;n>=0;n--)if(f=s[n],"link_close"!==f.type){if("html_inline"===f.type&&(i(f.content)&&a>0&&a--,l(f.content)&&a++),!(a>0)&&"text"===f.type&&(g=f.content,d=g.match(q),null!==d)){for(_=[],w=f.level,o=0;o<d.length;o++)h=d[o].match(k),y=g.indexOf(d[o]),v=h[1],m=h[2],y>0&&_.push({type:"text",content:g.slice(0,y),level:w}),x=u(m),x?(_.push({type:"mention_open",content:x.url||"/people/"+x.guid,level:w++}),_.push({type:"mention_text",content:p(v),level:w}),_.push({type:"mention_close",content:m,level:--w})):_.push({type:"text",content:v,level:w}),g=g.slice(y+h[0].length);g.length>0&&_.push({type:"text",content:g,level:e.level}),s=c(s,n,_),E[t].children=s}}else for(n--;s[n].level!==f.level&&"link_open"!==s[n].type;)n--}var c=e.utils.arrayReplaceAt,p=e.utils.escapeHtml;e.core.ruler.after("inline","mention",f),e.renderer.rules.mention_open=t,e.renderer.rules.mention_text=o,e.renderer.rules.mention_close=r}},{}]},{},[1])(1)});