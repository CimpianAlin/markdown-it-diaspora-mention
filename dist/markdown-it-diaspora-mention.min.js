/*! markdown-it-diaspora-mention 0.0.0 https://github.com/diaspora/markdown-it-diaspora-mention @license MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.markdownitDiasporaMention=e()}}(function(){return function e(n,t,r){function o(l,u){if(!t[l]){if(!n[l]){var f="function"==typeof require&&require;if(!u&&f)return f(l,!0);if(i)return i(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var p=t[l]={exports:{}};n[l][0].call(p.exports,function(e){var t=n[l][1][e];return o(t?t:e)},p,p.exports,e,n,t,r)}return t[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,n){"use strict";function t(e,n){return'<a class="mention" href="'+e[n].content+'">'}function r(){return"</a>"}function o(e,n){return e[n].content}function i(e){return/^<a[>\s]/i.test(e)}function l(e){return/^<\/a\s*>/i.test(e)}n.exports=function(e,n){function u(e){var t;for(t=0;t<n.length;t++)if(e===n[t].diaspora_id||e===n[t].handle)return n[t];return null}function f(e){var n,t,r,o,f,p,s,a,d,h,y,v,m,x,g,_,w,k,q=e.tokens,E="@\\{([^;]+); ([^\\}]+)\\}";for(w=new RegExp(E),k=new RegExp(E,"g"),t=0,r=q.length;r>t;t++)if("inline"===q[t].type)for(p=q[t].children,s=0,n=p.length-1;n>=0;n--)if(f=p[n],"link_close"!==f.type){if("html_inline"===f.type&&(i(f.content)&&s>0&&s--,l(f.content)&&s++),!(s>0)&&"text"===f.type&&(x=f.content,a=x.match(k),null!==a)){for(g=[],_=f.level,o=0;o<a.length;o++)d=a[o].match(w),h=x.indexOf(a[o]),y=d[1],v=d[2],h>0&&g.push({type:"text",content:x.slice(0,h),level:_}),m=u(v),m?(g.push({type:"mention_open",content:m.url||"/people/"+m.guid,level:_++}),g.push({type:"mention_text",content:y,level:_}),g.push({type:"mention_close",content:v,level:--_})):g.push({type:"text",content:y,level:_}),x=x.slice(h+d[0].length);x.length>0&&g.push({type:"text",content:x,level:e.level}),p=c(p,n,g),q[t].children=p}}else for(n--;p[n].level!==f.level&&"link_open"!==p[n].type;)n--}var c=e.utils.arrayReplaceAt;e.core.ruler.after("inline","mention",f),e.renderer.rules.mention_open=t,e.renderer.rules.mention_text=o,e.renderer.rules.mention_close=r}},{}]},{},[1])(1)});