/*! markdown-it-diaspora-mention 0.4.0 https://github.com/diaspora/markdown-it-diaspora-mention @license MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.markdownitDiasporaMention=e()}}(function(){return function e(n,t,r){function o(l,u){if(!t[l]){if(!n[l]){var f="function"==typeof require&&require;if(!u&&f)return f(l,!0);if(i)return i(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[l]={exports:{}};n[l][0].call(s.exports,function(e){var t=n[l][1][e];return o(t?t:e)},s,s.exports,e,n,t,r)}return t[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,n,t){"use strict";function r(e,n){return'<a href="'+e[n].content+'" class="'+e[n].linkclass+'">'}function o(){return"</a>"}function i(e,n){return e[n].content}function l(e){return/^<a[>\s]/i.test(e)}function u(e){return/^<\/a\s*>/i.test(e)}n.exports=function(e,n){function t(e){var n;for(n=0;n<p.length;n++)if(e===p[n].diaspora_id||e===p[n].handle)return p[n];return null}function f(e){var n,r,o,i,f,p,h,v,m,w,y,x,g,_,k,b,q,E,O,U,D=e.tokens,H=e.Token,R="@\\{([^;]+); ([^\\}]+)\\}";for(O=new RegExp(R),U=new RegExp(R,"g"),r=0,o=D.length;o>r;r++)if("inline"===D[r].type)for(p=D[r].children,v=0,n=p.length-1;n>=0;n--)if(f=p[n],"link_close"!==f.type){if("html_inline"===f.type&&(l(f.content)&&v>0&&v--,u(f.content)&&v++),!(v>0)&&"text"===f.type&&(b=f.content,m=b.match(U),null!==m)){for(q=[],E=f.level,i=0;i<m.length;i++)w=m[i].match(O),y=b.indexOf(m[i]),x=w[1],g=w[2],k="mention",y>0&&(h=new H("text","",0),h.content=b.slice(0,y),h.level=E,q.push(h)),_=t(g),_?(s&&_.guid!==c&&(k+=" hovercardable"),h=new H("mention_open","",1),h.content=_.url||"/people/"+_.guid,h.linkclass=k,h.level=E++,q.push(h),h=new H("mention_text","",0),h.content=a(x).trim(),h.level=E,q.push(h),h=new H("mention_close","",-1),h.level=--E,q.push(h)):(h=new H("text","",0),h.content=x,h.level=E,q.push(h)),b=b.slice(y+w[0].length);b.length>0&&(h=new H("text","",0),h.content=b,h.level=e.level,q.push(h)),D[r].children=p=d(p,n,q)}}else for(n--;p[n].level!==f.level&&"link_open"!==p[n].type;)n--}var c,s,d=e.utils.arrayReplaceAt,a=e.utils.escapeHtml,p=[];"undefined"!=typeof n.mentions&&(p=n.mentions),"undefined"!=typeof n.currentUserId&&(c=n.currentUserId),"undefined"!=typeof n.allowHovercards&&(s=n.allowHovercards),e.core.ruler.after("inline","mention",f),e.renderer.rules.mention_open=r,e.renderer.rules.mention_text=i,e.renderer.rules.mention_close=o}},{}]},{},[1])(1)});
